#### Словоформы и синонимы:

Задание анализатора для поля в документе, который последовательно

- переводит текст в нижний регистр
- убирает стоп-слова русской морфологии (предлоги, союзы и т.д.)
- преобразовывает слова (термы) в корневую форму для возможности поиска по словоформам
- добавляет синонимы

```shell
curl --location --request PUT 'localhost:41554/products' \
--header 'Content-Type: application/json' \
--data-raw '{
    "settings": {
        "index": {
            "number_of_shards": 1,
            "number_of_replicas": 0
        },
        "analysis": {
            "filter": {
                "russian_stop": {
                    "type": "stop",
                    "stopwords": "_russian_"
                },
                "russian_stemmer": {
                    "type": "stemmer",
                    "language": "russian"
                },
                "my_synonym": {
                    "type": "synonym",
                    "synonyms": [
                        "айфон => iphone",
                        "хонор => honor",
                        "блокнот => тетрадь"
                    ]
                }
            },
            "analyzer": {
                "my_ru_analyzer": {
                    "tokenizer": "standard",
                    "filter": [
                        "lowercase",
                        "russian_stop",
                        "russian_stemmer",
                        "my_synonym"
                    ]
                }
            }
        }
    },
    "mappings": {
        "properties": {
            "title": {
                "type": "text",
                "analyzer": "my_ru_analyzer"
            }
        }
    }
}'
```

Вставка данных:

```shell
curl --location --request POST 'localhost:41554/_bulk' \
--header 'Content-Type: application/json' \
--data-raw '{"index":{"_index":"products"}}
{"title": "iPhone 13"}
{"index":{"_index":"products"}}
{"title": "iPhone 14"}
{"index":{"_index":"products"}}
{"title": "Honor X8"}
{"index":{"_index":"products"}}
{"title": "Тетрадь"}
'
```

Поиск по словоформе:

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "тетрадей",
                "analyzer": "my_ru_analyzer"
            }
        }
    }
}'
```

Поиск по синонимам:

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "блокнотами",
                "analyzer": "my_ru_analyzer"
            }
        }
    }
}'
```

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "айфон",
                "analyzer": "my_ru_analyzer"
            }
        }
    }
}'
```

#### Поиск по нечёткому соответствию:

Мера "нечёткости" - расстояние Левенштейна. Слово *титрадей* намеренно написано с ошибкой:

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "титрадей",
                "analyzer": "my_ru_analyzer",
                "fuzziness": 1
            }
        }
    }
}'
```

#### Поиск по части слова:

Для этого используется n-gram индекс:

```shell
curl --location --request PUT 'localhost:41554/products' \
--header 'Content-Type: application/json' \
--data-raw '{
    "settings": {
        "index": {
            "number_of_shards": 1,
            "number_of_replicas": 0
        },
        "analysis": {
            "filter": {
                "my_ngram_filter": {
                    "type": "ngram"
                }
            },
            "analyzer": {
                "my_ngram_analyzer": {
                    "type": "custom",
                    "tokenizer": "standard",
                    "filter": [
                        "lowercase",
                        "my_ngram_filter"
                    ]
                }
            }
        }
    },
    "mappings": {
        "properties": {
            "title": {
                "type": "text",
                "analyzer": "my_ngram_analyzer"
            }
        }
    }
}'
```

Вставка данных:

```shell
curl --location --request POST 'localhost:41554/_bulk' \
--header 'Content-Type: application/json' \
--data-raw '{"index":{"_index":"products"}}
{"title": "iPhone 13"}
{"index":{"_index":"products"}}
{"title": "iPhone 14"}
{"index":{"_index":"products"}}
{"title": "Honor X8"}
{"index":{"_index":"products"}}
{"title": "Тетрадь"}
'
```

Поиск:

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "тр",
                "analyzer": "my_ngram_analyzer"
            }
        }
    }
}'
```

##### Поиск по началу слова (используется для автозавершения):

Для этого используется edge n-gram индекс:

```shell
curl --location --request PUT 'localhost:41554/products' \
--header 'Content-Type: application/json' \
--data-raw '{
    "settings": {
        "index": {
            "number_of_shards": 1,
            "number_of_replicas": 0
        },
        "analysis": {
            "filter": {
                "my_ngram_filter": {
                    "type": "edge_ngram",
                    "min_gram": 1,
                    "max_gram": 5
                }
            },
            "analyzer": {
                "my_ngram_analyzer": {
                    "type": "custom",
                    "tokenizer": "standard",
                    "filter": [
                        "lowercase",
                        "my_ngram_filter"
                    ]
                }
            }
        }
    },
    "mappings": {
        "properties": {
            "title": {
                "type": "text",
                "analyzer": "my_ngram_analyzer"
            }
        }
    }
}'
```

Вставка данных:

```shell
curl --location --request POST 'localhost:41554/_bulk' \
--header 'Content-Type: application/json' \
--data-raw '{"index":{"_index":"products"}}
{"title": "iPhone 13"}
{"index":{"_index":"products"}}
{"title": "iPhone 14"}
{"index":{"_index":"products"}}
{"title": "Honor X8"}
{"index":{"_index":"products"}}
{"title": "Тетрадь"}
'
```

Поиск:

```shell
curl --location --request POST 'localhost:41554/products/_search' \
--header 'Content-Type: application/json' \
--data-raw '{
    "query": {
        "match": {
            "title": {
                "query": "ho",
                "analyzer": "my_ngram_analyzer"
            }
        }
    }
}'
```
