docker-compose.yml:

```yaml
version: '3.8'

services:
  clickhouse:
    container_name: clickhouse_sirius
    image: bitnami/clickhouse:22.3.15
    environment:
      CLICKHOUSE_ADMIN_USER: clickhouse
      CLICKHOUSE_ADMIN_PASSWORD: clickhouse
    ports:
      - "53765:8123"
```

Создание таблиц:

```sql
drop table if exists equipment;
drop table if exists holder;

create table holder
(
    name                        text,
    phone                       text,
    -- массив вложенных объектов { name: text; completion_year: int; degree: text; }:
    "education.name"            Array(text),
    "education.completion_year" Array(int),
    "education.degree"          Array(text)
) engine = ReplacingMergeTree() order by (phone); -- phone является так же первичным ключом, по которому сборщик мусора будет удалять старые записи

create table equipment
(
    title        text,
    holder_phone text,
    count        int,
    type         text,
    weight       int,
    price        decimal(50, 4)
) engine = Memory();
```

Вставка данных:

```sql
insert into holder (name, phone, "education.name", "education.completion_year", "education.degree")
values ('Альберт Андреевич', '0001', ['СПбГУ', 'МГУ'], [2015, 2020], ['bachelor', 'magister']),
       ('Иван Вячеславович', '0002', ['КФУ', 'ВШЭ'], [2014, 2019], ['magister', 'phd']),
       ('Вячеслав Александрович', '0003', [], [], []),
       ('Алексей Андреевич', '0004', [], [], []);

insert into equipment (title, count, holder_phone, type, weight, price)
values ('Защитный комплект', 8, '0003', 'Фигурное катание', 780, 2300),
       ('Термос', 4, '0001', 'Поход', 240, 670),
       ('Коньки', 7, '0002', 'Фигурное катание', 920, 1990),
       ('Автомат', 4, '0002', 'Страйкбол', 3100, 13900),
       ('Ледоступы (пары)', 6, '0001', 'Альпинизм', 93, 599),
       ('Пистолет', 12, '0001', 'Страйкбол', 370, 2100),
       ('Стропы', 7, '0003', 'Альпинизм', 1800, 9900),
       ('Дождевик', 10, '0002', 'Поход', 140, 1100),
       ('Дротик', 9, '0001', 'Дартс', 8, 65),
       ('Маска защитная', 14, '0001', 'Страйкбол', 550, 1900),
       ('Мяч', 3, '0001', 'Настольный теннис', 3, 70),
       ('Гидрокостюм', 12, '0002', 'Дайвинг', 1500, 4490),
       ('Ледоруб', 8, '0003', 'Альпинизм', 450, 7760),
       ('Сноуборд', 13, '0001', 'Сноубординг', 2560, 5780),
       ('Компенсатор', 11, '0002', 'Дайвинг', 1100, 28000),
       ('Ракетка', 2, '0003', 'Настольный теннис', 200, 1345),
       ('Нагрудник', 13, '0001', 'Страйкбол', 2900, 5560),
       ('Спальник', 5, '0001', 'Поход', 1300, 1790),
       ('Мишень', 1, '0001', 'Дартс', 4630, 3120),
       ('Удочка', 2, '0001', 'Рыбалка', 80, 1500),
       ('Сетка', 1, '0003', 'Настольный теннис', 760, 2450),
       ('Компас', 1, '0003', 'Поход', 50, 180),
       ('Ботинки (пары)', 15, '0003', 'Сноубординг', 980, 8700),
       ('Мангал', 1, '0002', 'Поход', 23000, 7900),
       ('Акваланг', 8, '0003', 'Дайвинг', 9800, 31500),
       ('Палатка', 6, '0003', 'Поход', 2400, 3330),
       ('Маска для плавания', 12, '0001', 'Дайвинг', 575, 1560),
       ('Ласты', 9, '0002', 'Дайвинг', 220, 2950),
       ('Рюкзак', 10, '0002', 'Поход', 1000, 2900);
```

Поиск по вложенным объектам:

```sql
select *
from holder
where has("education.name", 'МГУ');
```

Применение агрегаций к вложенным объектам:

```sql
select min("education.completion_year")
from holder 
    array join "education.completion_year";
```

Обновление данных (вставка с существующим ключом):

```sql
insert into holder (name, phone, "education.name", "education.completion_year", "education.degree")
values ('Альберт Андреевич', '0001', ['СПбГУ', 'МГУ', 'ТВГУ'], [2015, 2020, 2022], ['bachelor', 'magister', 'phd']);
```

Вывод последних версий строк из таблицы:

```sql
select * from holder final;
```
