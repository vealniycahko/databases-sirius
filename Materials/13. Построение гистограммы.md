# Используемая база данных

```sql
drop table if exists equipment cascade;
drop table if exists holder cascade;

create table holder
(
    name  text,
    phone text primary key
);

insert into holder (name, phone)
values ('Альберт Андреевич', '0001'),
       ('Иван Вячеславович', '0002'),
       ('Вячеслав Александрович', '0003'),
       ('Алексей Андреевич', '0004');

create table equipment
(
    title        text,
    holder_phone text references holder,
    count        int,
    type         text,
    weight       int,
    price        numeric
);

insert into equipment (title, count, holder_phone, type, weight, price)
values ('Защитный комплект', 8, '0003', 'Фигурное катание', 780, 2300),
       ('Термос', 4, '0001', 'Поход', 240, 670),
       ('Коньки', 7, '0002', 'Фигурное катание', 920, 1990),
       ('Автомат', 4, '0002', 'Страйкбол', 3100, 13900),
       ('Ледоступы (пары)', 6, '0001', 'Альпинизм', 93, 599),
       ('Пистолет', 12, '0001', 'Страйкбол', 370, 2100),
       ('Стропы', 7, '0003', 'Альпинизм', 1800, 9900),
       ('Дождевик', 10, '0002', 'Поход', 140, 1100),
       ('Дротик', 9, '0001', 'Дартс', 8, 65),
       ('Маска защитная', 14, '0001', 'Страйкбол', 550, 1900),
       ('Мяч', 3, '0001', 'Настольный теннис', 3, 70),
       ('Гидрокостюм', 12, '0002', 'Дайвинг', 1500, 4490),
       ('Ледоруб', 8, '0003', 'Альпинизм', 450, 7760),
       ('Сноуборд', 13, '0001', 'Сноубординг', 2560, 5780),
       ('Компенсатор', 11, '0002', 'Дайвинг', 1100, 28000),
       ('Ракетка', 2, '0003', 'Настольный теннис', 200, 1345),
       ('Нагрудник', 13, '0001', 'Страйкбол', 2900, 5560),
       ('Спальник', 5, '0001', 'Поход', 1300, 1790),
       ('Мишень', 1, '0001', 'Дартс', 4630, 3120),
       ('Удочка', 2, '0001', 'Рыбалка', 80, 1500),
       ('Сетка', 1, '0003', 'Настольный теннис', 760, 2450),
       ('Компас', 1, '0003', 'Поход', 50, 180),
       ('Ботинки (пары)', 15, '0003', 'Сноубординг', 980, 8700),
       ('Мангал', 1, '0002', 'Поход', 23000, 7900),
       ('Акваланг', 8, '0003', 'Дайвинг', 9800, 31500),
       ('Палатка', 6, '0003', 'Поход', 2400, 3330),
       ('Маска для плавания', 12, '0001', 'Дайвинг', 575, 1560),
       ('Ласты', 9, '0002', 'Дайвинг', 220, 2950),
       ('Рюкзак', 10, '0002', 'Поход', 1000, 2900);
```

# Гистограмма распределения экипировки по ценовым диапазонам

```sql
with max_price as (select max(price) as price from equipment),
     histogram as (select width_bucket(price, 0, (select price from max_price), 9) as bucket,
                          count(*)                                                 as frequency
                   from equipment
                   group by bucket)
select bucket,
       frequency,
       (bucket - 1) * (select price / 10 from max_price) as range_from,
       bucket * (select price / 10 from max_price)       as range_to
from histogram
order by bucket;
```

# Результат:
| bucket | frequency | range\_from | range\_to |
|:-------|:----------|:------------|:----------|
| 1      | 19        | 0           | 3150      |
| 2      | 3         | 3150        | 6300      |
| 3      | 4         | 6300        | 9450      |
| 4      | 1         | 9450        | 12600     |
| 9      | 1         | 25200       | 28350     |
| 10     | 1         | 28350       | 31500     |
